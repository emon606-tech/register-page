<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Register</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

    /* Reset & base */
    * {
      box-sizing: border-box;
    }
    body, html {
      margin: 0; padding: 0;
      height: 100%;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      display: flex;
      justify-content: center;
      align-items: center;
      color: #eee;
      user-select: none;
    }

    /* Container with glassmorphism */
    .container {
      background: rgba(255 255 255 / 0.05);
      border-radius: 15px;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255 255 255 / 0.18);
      padding: 40px 35px;
      width: 380px;
      max-width: 90vw;
      animation: fadeIn 1s ease forwards;
    }

    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(20px);}
      to {opacity: 1; transform: translateY(0);}
    }

    /* Title */
    h2 {
      font-weight: 600;
      text-align: center;
      margin-bottom: 30px;
      font-size: 2.2rem;
      letter-spacing: 1.2px;
      color: #0ff9ff;
      text-shadow: 0 0 8px #0ff9ff88;
      user-select: text;
    }

    /* Floating label inputs */
    .form-group {
      position: relative;
      margin-bottom: 25px;
    }

    input {
      width: 100%;
      padding: 14px 14px 14px 14px;
      border-radius: 8px;
      border: 2px solid #444;
      background: rgba(255 255 255 / 0.05);
      color: #eee;
      font-size: 1rem;
      outline: none;
      transition: border-color 0.3s ease;
    }

    input:focus {
      border-color: #0ff9ff;
      box-shadow: 0 0 8px #0ff9ff88;
    }

    label {
      position: absolute;
      left: 14px;
      top: 50%;
      color: #aaa;
      pointer-events: none;
      transform: translateY(-50%);
      transition: 0.3s ease all;
      font-size: 1rem;
      user-select: none;
    }

    input:focus + label,
    input:not(:placeholder-shown) + label {
      top: 4px;
      font-size: 0.75rem;
      color: #0ff9ff;
      user-select: text;
    }

    /* Password strength bar */
    .strength-bar {
      width: 100%;
      height: 10px;
      background: #222;
      border-radius: 6px;
      overflow: hidden;
      margin-top: 6px;
      box-shadow: inset 0 0 5px #000;
    }
    .strength-bar > div {
      height: 100%;
      width: 0%;
      background: red;
      border-radius: 6px;
      transition: width 0.3s ease, background-color 0.3s ease;
    }

    /* Button */
    button {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #00fff7, #00c2f7);
      border: none;
      border-radius: 10px;
      font-weight: 600;
      font-size: 1.1rem;
      color: #111;
      cursor: pointer;
      box-shadow: 0 4px 15px #00c2f7aa;
      user-select: none;
      position: relative;
      overflow: hidden;
      transition: background 0.3s ease;
    }
    button:hover:not(:disabled) {
      background: linear-gradient(135deg, #00c2f7, #00fff7);
      box-shadow: 0 6px 20px #00fff7cc;
    }
    button:disabled {
      cursor: not-allowed;
      background: #0a1924;
      box-shadow: none;
      color: #555;
    }

    /* Loading spinner */
    .loading-spinner {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top: 3px solid #00c2f7;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      animation: spin 1s linear infinite;
      position: absolute;
      top: 50%;
      left: 18px;
      transform: translateY(-50%);
      display: none;
    }
    button.loading .loading-spinner {
      display: block;
    }
    button.loading span {
      margin-left: 30px;
    }
    @keyframes spin {
      0% {transform: rotate(0deg);}
      100% {transform: rotate(360deg);}
    }

    /* Messages */
    #errorMsg {
      color: #ff6b6b;
      text-align: center;
      margin-top: 12px;
      min-height: 24px;
      font-weight: 600;
      user-select: text;
    }
    #successMsg {
      color: #00fff7;
      text-align: center;
      margin-top: 12px;
      min-height: 24px;
      font-weight: 600;
      user-select: text;
    }

    /* Responsive */
    @media (max-width: 400px) {
      .container {
        width: 90vw;
        padding: 30px 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container" role="main" aria-label="Registration form">
    <h2>Register</h2>

    <form id="registerForm" autocomplete="off" spellcheck="false" novalidate>
      <div class="form-group">
        <input type="email" id="email" placeholder=" " required />
        <label for="email">Enter your valid email</label>
      </div>

      <div class="form-group">
        <input type="text" id="username" placeholder=" " required />
        <label for="username">Enter your username (First letter uppercase)</label>
      </div>

      <div class="form-group">
        <input type="password" id="password" placeholder=" " required />
        <label for="password">Enter your password (min 6 chars)</label>
        <div class="strength-bar" aria-label="password strength">
          <div id="strengthFill"></div>
        </div>
      </div>

      <div class="form-group">
        <input type="password" id="confirmPassword" placeholder=" " required />
        <label for="confirmPassword">Confirm your password</label>
      </div>

      <button type="submit" aria-live="polite" aria-busy="false">
        <div class="loading-spinner" aria-hidden="true"></div><span>Register</span>
      </button>

      <p id="errorMsg" role="alert" aria-live="assertive"></p>
      <p id="successMsg" role="alert" aria-live="polite"></p>
    </form>
  </div>

<script>
  const form = document.getElementById('registerForm');
  const errorMsg = document.getElementById('errorMsg');
  const successMsg = document.getElementById('successMsg');
  const passwordInput = document.getElementById('password');
  const strengthFill = document.getElementById('strengthFill');
  const button = form.querySelector('button');

  // Password strength calculation (0-4)
  function calcStrength(pass) {
    let strength = 0;
    if (pass.length >= 6) strength++;
    if (/[A-Z]/.test(pass)) strength++;
    if (/[0-9]/.test(pass)) strength++;
    if (/[^A-Za-z0-9]/.test(pass)) strength++;
    return strength;
  }

  function updateStrengthBar() {
    const pass = passwordInput.value;
    const strength = calcStrength(pass);
    const percent = (strength / 4) * 100;
    strengthFill.style.width = percent + '%';

    if (strength <= 1) strengthFill.style.backgroundColor = '#ff4d4d'; // red
    else if (strength === 2) strengthFill.style.backgroundColor = '#ffa500'; // orange
    else if (strength === 3) strengthFill.style.backgroundColor = '#9acd32'; // yellowgreen
    else strengthFill.style.backgroundColor = '#00fff7'; // cyan
  }

  passwordInput.addEventListener('input', () => {
    updateStrengthBar();
    clearMessages();
  });

  function clearMessages() {
    errorMsg.textContent = '';
    successMsg.textContent = '';
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    clearMessages();

    button.disabled = true;
    button.classList.add('loading');
    button.setAttribute('aria-busy', 'true');

    const email = document.getElementById('email').value.trim();
    const user = document.getElementById('username').value.trim();
    const pass = passwordInput.value;
    const confirmPass = document.getElementById('confirmPassword').value;

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      showError('Invalid email format.');
      finishLoading();
      return;
    }

    if (!/^[A-Z][a-zA-Z0-9]*$/.test(user)) {
      showError('Username must start with uppercase letter and contain no . , / characters.');
      finishLoading();
      return;
    }
    if (/[.,\/]/.test(user)) {
      showError('Username cannot contain ".", "," or "/".');
      finishLoading();
      return;
    }

    if (pass.length < 6) {
      showError('Password must be at least 6 characters.');
      finishLoading();
      return;
    }

    if (pass !== confirmPass) {
      showError('Passwords do not match.');
      finishLoading();
      return;
    }

    if (calcStrength(pass) < 2) {
      showError('Password is too weak.');
      finishLoading();
      return;
    }

    try {
      const res = await fetch('/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, username: user, password: pass }),
      });

      if (res.ok) {
        successMsg.textContent = 'User registered successfully!';
        form.reset();
        strengthFill.style.width = '0%';
      } else {
        const msg = await res.text();
        showError(msg || 'Registration failed.');
      }
    } catch (err) {
      showError('Server error. Please try again later.');
    }

    finishLoading();
  });

  function showError(msg) {
    errorMsg.textContent = msg;
    successMsg.textContent = '';
  }
  function finishLoading() {
    button.disabled = false;
    button.classList.remove('loading');
    button.setAttribute('aria-busy', 'false');
  }
</script>
</body>
</html>
